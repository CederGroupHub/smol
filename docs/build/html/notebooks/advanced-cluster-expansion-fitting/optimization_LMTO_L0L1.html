<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Creating a basic Cluster Expansion &#8212; smol 1.0.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/bootstrap-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/_static/default.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "document", "processHtmlClass": "math|output_area"}}</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../../_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="../../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../../_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../../_static/bootstrap-sphinx.js "></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../index.html">
          smol</a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../../examples.html">Examples</a></li>
                <li><a href="../../api.html">API</a></li>
                <li><a href="https://github.com/CederGroupHub/smol">GitHub</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"></ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Creating a basic Cluster Expansion</a></li>
<li><a class="reference internal" href="#Load-a-cluster-expansion-file-from-previous-saved-one">Load a cluster expansion file from previous saved one</a></li>
<li><a class="reference internal" href="#Training-part">Training part</a></li>
<li><a class="reference internal" href="#Optimization-of-\ell_1-regularization-in-Li-Mn-Ti-O-system">Optimization of <span class="math notranslate nohighlight">\(\ell_1\)</span> regularization in Li-Mn-Ti-O system</a></li>
<li><a class="reference internal" href="#Optimization-of-\ell_1\ell_0-regularization-in-Li-Mn-Ti-O-system">Optimization of <span class="math notranslate nohighlight">\(\ell_1\ell_0\)</span> regularization in Li-Mn-Ti-O system</a></li>
<li><a class="reference internal" href="#Comparison-of-\ell_1-and-\ell_1\ell_0-in-Li-Mn-Ti-O-system">Comparison of <span class="math notranslate nohighlight">\(\ell_1\)</span> and <span class="math notranslate nohighlight">\(\ell_1\ell_0\)</span> in Li-Mn-Ti-O system</a><ul>
<li><a class="reference internal" href="#4)-The-cluster-expansion">4) The cluster expansion</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<section id="Creating-a-basic-Cluster-Expansion">
<h1>Creating a basic Cluster Expansion<a class="headerlink" href="#Creating-a-basic-Cluster-Expansion" title="Permalink to this headline">¶</a></h1>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">monty.serialization</span> <span class="kn">import</span> <span class="n">loadfn</span><span class="p">,</span> <span class="n">dumpfn</span>
<span class="kn">from</span> <span class="nn">pymatgen.core.structure</span> <span class="kn">import</span> <span class="n">Structure</span>
<span class="kn">from</span> <span class="nn">smol.cofe</span> <span class="kn">import</span> <span class="n">ClusterSubspace</span><span class="p">,</span> <span class="n">StructureWrangler</span><span class="p">,</span> <span class="n">ClusterExpansion</span>
<span class="kn">from</span> <span class="nn">smol.cofe.extern</span> <span class="kn">import</span> <span class="n">EwaldTerm</span>
<span class="kn">from</span> <span class="nn">smol.io</span> <span class="kn">import</span> <span class="n">load_work</span><span class="p">,</span> <span class="n">save_work</span>
<span class="kn">from</span> <span class="nn">theorytoolkit.optimization.ce_sparse_opt</span> <span class="kn">import</span> <span class="o">*</span>

</pre></div>
</div>
</div>
</section>
<section id="Load-a-cluster-expansion-file-from-previous-saved-one">
<h1>Load a cluster expansion file from previous saved one<a class="headerlink" href="#Load-a-cluster-expansion-file-from-previous-saved-one" title="Permalink to this headline">¶</a></h1>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[52]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>

<span></span><span class="n">work</span> <span class="o">=</span> <span class="n">load_work</span><span class="p">(</span><span class="s1">&#39;../data/LMTO.mson&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">work</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
StructureWrangler: &lt;class &#39;smol.cofe.wrangler.StructureWrangler&#39;&gt;

ClusterExpansion: &lt;class &#39;smol.cofe.expansion.ClusterExpansion&#39;&gt;

</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[53]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">wrangler</span> <span class="o">=</span> <span class="n">work</span><span class="p">[</span><span class="s1">&#39;StructureWrangler&#39;</span><span class="p">]</span>
<span class="n">ce</span> <span class="o">=</span> <span class="n">work</span><span class="p">[</span><span class="s1">&#39;ClusterExpansion&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</section>
<section id="Training-part">
<h1>Training part<a class="headerlink" href="#Training-part" title="Permalink to this headline">¶</a></h1>
<p>Training a cluster expansion is one of the most critical steps. This is how you get <strong>effective cluster interactions (ECI’s)</strong>. Here we show two simple example to apply typical <span class="math notranslate nohighlight">\(\ell_1\)</span> regularized regression and <span class="math notranslate nohighlight">\(\ell_0\ell_1\)</span> regularized regression with mixed integer qudraptic programming with <code class="docutils literal notranslate"><span class="pre">gurobi</span></code> pakage.</p>
<p>In <code class="docutils literal notranslate"><span class="pre">smol</span></code> the coefficients from the fit are not exactly the ECI’s but the ECI times the multiplicity of their orbit.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">wrangler</span><span class="o">.</span><span class="n">feature_matrix</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([[1.        , 0.5       , 0.        , ..., 0.        , 0.        ,
        0.        ],
       [1.        , 0.5       , 0.        , ..., 0.        , 0.        ,
        0.        ],
       [1.        , 0.5       , 0.        , ..., 0.        , 0.        ,
        0.        ],
       ...,
       [1.        , 0.625     , 0.25      , ..., 0.02083333, 0.        ,
        0.        ],
       [1.        , 0.625     , 0.25      , ..., 0.01388889, 0.        ,
        0.        ],
       [1.        , 0.625     , 0.25      , ..., 0.03472222, 0.        ,
        0.        ]])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Different from pyabinitio, normalized refers to the original data whether normalzied. So the key</span>
<span class="sd">total_energy here is actually normalized.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="n">wrangler</span><span class="o">.</span><span class="n">get_property_vector</span><span class="p">(</span><span class="s1">&#39;total_energy&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([-13.11874117, -13.12903802, -13.17137952, -13.08021449,
       -13.16362834, -13.10222821, -13.08156161, -13.15720459,
       -13.06331364, -13.12062745, -13.17905239, -13.12440631,
       -13.17411988, -13.20385514, -13.10332586, -13.12882567,
       -13.13764792, -13.14550215, -13.1109768 , -13.13433355,
       -13.08290429, -13.15571512, -13.12275268, -13.15715223,
       -13.09132904, -13.08556145, -13.03954859, -13.12791847,
       -13.12750551, -13.08865104, -13.05968182, -13.13590795,
       -13.1004459 , -13.17690217, -13.14593605, -13.11400736,
       -13.12124423, -13.14953541, -13.12336135, -13.13870288,
       -13.14821189, -13.02921938, -13.10899456, -13.01145925,
       -13.02529022, -13.09379601, -13.13166383, -13.06279359,
       -13.11696813, -13.13820625, -13.07975418, -12.97458318,
       -13.1316143 , -13.11638331, -13.15155213, -13.0794376 ,
       -13.13064402, -13.15555385, -13.12331726, -13.10800658,
       -13.01404902, -13.00900896, -13.09916021, -13.10927153,
       -13.07672251, -13.13185649, -13.11282708, -13.12167617,
       -13.04087802, -13.01169684, -13.0587653 , -13.11458426,
       -12.90934915, -13.0502978 , -13.00419219, -13.10310079,
       -13.04888816, -13.09223751, -13.17093394, -13.10057156,
       -13.06968691, -13.09618374, -13.0463362 , -13.05644464,
       -13.1565299 , -13.15934391, -13.18127829, -13.1192396 ,
       -13.1157498 , -13.0959997 , -13.06298953, -13.02108122,
       -13.07427856, -13.11027339, -13.12953357, -13.93821846,
       -13.98331634, -13.96423646, -12.99992881, -13.09001874,
       -13.09008873, -13.1069478 , -13.04828666, -13.04175016,
       -13.07123935, -13.07452567, -13.11729511, -13.09430927,
       -13.20387125, -13.1578425 , -13.04089833, -13.14134556,
       -13.17340083, -13.06349639, -13.14546111, -13.1612075 ,
       -13.10924472, -13.13041667, -13.11130139, -13.1332675 ,
       -13.16401472, -13.10441333, -13.13344667, -13.11192056,
       -13.12980389, -13.07824583, -13.14101417, -13.10469306,
       -13.14541   , -13.14256958, -13.10940667, -13.11275792,
       -13.080615  , -13.07073   , -13.10594167, -13.10149   ,
       -13.09036861, -13.14154556, -13.14064333, -13.137325  ,
       -13.13474111, -13.13045861, -13.13669611, -13.10038056,
       -13.10118583, -13.07293   , -13.10892   , -13.06265111,
       -13.12131167, -13.12181917, -13.12554417, -13.14341778,
       -13.14350333, -13.12254972, -13.14204528, -13.14661278,
       -13.13789194, -13.08177278, -13.08414111, -13.05187639,
       -13.09285972, -13.08991806, -13.09019083, -13.11819889,
       -13.13416222, -13.12714417, -13.13110833, -13.13611889,
       -13.14361833, -13.13564556, -13.14480778, -13.14591389,
       -13.15782806, -13.12951917, -13.06116361, -13.07472583,
       -13.11633444, -13.08863694, -13.11368389, -13.11555417,
       -13.14010194, -13.12396806, -13.12511389, -13.12287639,
       -13.13116806, -13.12763139, -13.15545833, -13.10633458,
       -13.15945417, -13.98041333, -13.92583639, -13.98779472,
       -13.89786861, -13.88295722, -13.98405972, -14.01766944,
       -13.99375611, -13.970485  , -14.01760683, -13.975045  ,
       -13.77921217, -13.976957  , -13.98390317, -13.973006  ,
       -13.84717633, -13.99055778, -13.6544184 , -13.6210654 ,
       -13.1185075 , -13.08952583, -13.12549333, -13.12374958,
       -13.15853875, -13.11807917, -13.34785625, -13.29249208,
       -13.29037958, -13.31427625, -13.3407625 , -13.33056917,
       -13.34638083, -13.33701458, -13.34379958, -13.52041208,
       -13.54455333, -13.50460583, -13.54730667, -13.55183208,
       -13.55658375, -13.5617875 , -13.74062667, -13.72810792,
       -13.69105583, -13.704175  , -13.74108667, -13.97290708,
       -13.97019875, -13.94800417, -13.97185417, -13.95053208,
       -13.98777875, -13.98162042, -13.09025444, -13.10207972,
       -13.10203528, -13.09289722, -13.09256   , -13.09419639,
       -13.13418639, -13.14196944, -13.13465083, -13.14032389,
       -13.14056444, -13.28789278, -13.23245333, -13.23603722,
       -13.22986833, -13.21636417, -13.23841556, -13.2503275 ,
       -13.27673417, -13.28149444, -13.26779   , -13.27011111,
       -13.24788917, -13.27223944, -13.28348167, -13.28171   ,
       -13.28310444, -13.29299306, -13.42904667, -13.37137056,
       -13.34412139, -13.35594528, -13.38306917, -13.31193444,
       -13.39412222, -13.40913778, -13.4021425 , -13.39436583,
       -13.4066625 , -13.53865556, -13.44803083, -13.51324194,
       -13.56212694, -13.53519472, -13.55070917, -13.54523194,
       -13.5507625 , -13.55167361, -13.55807722, -13.55651472,
       -13.54634   , -13.54936972, -13.54676417, -13.66570278,
       -13.6607925 , -13.66662167, -13.60968611, -13.64760139,
       -13.64959139, -13.68487472, -13.68938139, -13.68563139,
       -13.68131722, -13.68744278, -13.68599417, -13.6634575 ,
       -13.81898083, -13.80172361, -13.77560583, -13.78932139,
       -13.76024556, -13.76752   , -13.79636778, -13.84205917,
       -13.83469861, -13.83241944, -13.82626917, -13.82558833,
       -13.81543028, -13.82311083, -13.80582056, -13.98584306,
       -13.84087833, -13.9681475 , -13.8624    , -13.91771306,
       -13.90193972, -13.105365  , -13.08356889, -13.09323556,
       -13.1188525 , -13.12020611, -13.13287028, -13.14320806,
       -13.13023444, -13.11880667, -13.11299528, -13.13512222,
       -13.14391361, -13.141115  , -13.28696278, -13.24798972,
       -13.19752611, -13.20732694, -13.21752972, -13.20022306,
       -13.24457722, -13.25955306, -13.26468639, -13.26451861,
       -13.2517325 , -13.25024333, -13.27246167, -13.27950306,
       -13.27235389, -13.28117444, -13.27712611, -13.27558056,
       -13.35196444, -13.36560583, -13.36500667, -13.3439825 ,
       -13.38670417, -13.35645056, -13.40688528, -13.40375944,
       -13.392525  , -13.39459167, -13.40347056, -13.41443444,
       -13.4200325 , -13.51571   , -13.51313417, -13.53000472,
       -13.47688611, -13.55053   , -13.51717694, -13.56226944,
       -13.70336083, -13.65742556, -13.56850083, -13.61611639,
       -13.69044306, -13.69806917, -13.68666   , -13.69319528,
       -13.70045694, -13.70479306, -13.70367278, -13.70002889,
       -13.70513917, -13.70382917, -13.70004   , -13.85402417,
       -13.75708417, -13.79200028, -13.76500556, -13.76207056,
       -13.73069639, -13.7203475 , -13.85400194, -13.85606611,
       -13.85876917, -13.85539056, -13.846675  , -13.85842861,
       -13.85376861, -13.85732111, -13.85414944, -13.97238722,
       -13.94503361, -13.92957194, -13.92370194, -13.96124972,
       -13.10541722, -13.09848972, -13.10497056, -13.11042861,
       -13.08541083, -13.1358525 , -13.12282306, -13.13029944,
       -13.11401222, -13.14186389, -13.14219417, -13.14671083,
       -13.13504833, -13.27308556, -13.23535972, -13.23477833,
       -13.19849278, -13.23081361, -13.20476111, -13.24296167,
       -13.24020889, -13.26645056, -13.27706167, -13.25751556,
       -13.27586389, -13.2770425 , -13.2710475 , -13.2776975 ,
       -13.27951278, -13.26014056, -13.2689475 , -13.41926194,
       -13.36256278, -13.33308306, -13.28647722, -13.37189444,
       -13.33385556, -13.33259806, -13.38891472, -13.39180111,
       -13.40184611, -13.38486944, -13.41511528, -13.41874056,
       -13.41028194, -13.40036417, -13.40212167, -13.42302194,
       -13.5379725 , -13.45919917, -13.48712444, -13.5112975 ,
       -13.47293944, -13.55282417, -13.52368833, -13.53029972,
       -13.54682194, -13.54041833, -13.55521167, -13.54602111,
       -13.55371778, -13.55351667, -13.5566525 , -13.55854639,
       -13.68805472, -13.61252972, -13.62291444, -13.66610111,
       -13.6204725 , -13.696945  , -13.69176139, -13.66676944,
       -13.66838111, -13.66583194, -13.68540556, -13.68905333,
       -13.83446611, -13.82631528, -13.768465  , -13.65816444,
       -13.76284694, -13.7309375 , -13.74123361, -13.81717556,
       -13.79510889, -13.82381528, -13.82460417, -13.82498944,
       -13.81519194, -13.83430333, -13.8336575 , -13.82894083,
       -13.83365139, -13.98717528, -13.96827361, -13.90559083,
       -13.90611528, -13.88497056, -13.86087194, -13.97315806,
       -13.9958225 , -13.99543194, -13.93873333, -13.94036   ,
       -13.07098722, -13.11130222, -13.10844167, -13.08145722,
       -13.07384917, -13.12605056, -13.11794583, -13.10760583,
       -13.12773111, -13.14037111, -13.12115389, -13.14041611,
       -13.137315  , -13.21491278, -13.24539833, -13.20711333,
       -13.18051111, -13.22668972, -13.2296125 , -13.26500694,
       -13.24247   , -13.27303444, -13.25489667, -13.25021028,
       -13.27519306, -13.27714139, -13.2806775 , -13.26994889,
       -13.27528167, -13.32207583, -13.37016972, -13.392905  ,
       -13.33471306, -13.3841575 , -13.37723472, -13.40240861,
       -13.40766694, -13.39726944, -13.38731028, -13.3918025 ,
       -13.40768083, -13.39792056, -13.39992556, -13.40656944,
       -13.47546694, -13.45788389, -13.50745194, -13.55029639,
       -13.52151167, -13.52256639, -13.531935  , -13.50325389,
       -13.54369444, -13.55103361, -13.54291722, -13.55424861,
       -13.54699444, -13.55721139, -13.69365778, -13.62617722,
       -13.56791722, -13.65245   , -13.65468278, -13.64935361,
       -13.64893917, -13.68513278, -13.65361639, -13.63843917,
       -13.69744139, -13.69770361, -13.690305  , -13.69283556,
       -13.68838222, -13.84275417, -13.79533639, -13.7192375 ,
       -13.79394389, -13.73408   , -13.73262111, -13.81815389,
       -13.8206    , -13.83320944, -13.82823   , -13.83609167,
       -13.79211389, -13.85011667, -13.84169833, -13.84496917,
       -13.83715806, -13.8419975 , -13.92657028, -13.95843972,
       -13.91344722, -13.83904   , -13.96988389, -13.98643722,
       -13.98708   , -13.99590444, -13.14453542, -13.35526625,
       -13.340015  , -13.34658292, -13.35033292, -13.33110625,
       -13.50697708, -13.54938042, -13.63493375, -13.74114042,
       -13.60728083, -13.64882417])
</pre></div></div>
</div>
</section>
<section id="Optimization-of-\ell_1-regularization-in-Li-Mn-Ti-O-system">
<h1>Optimization of <span class="math notranslate nohighlight">\(\ell_1\)</span> regularization in Li-Mn-Ti-O system<a class="headerlink" href="#Optimization-of-\ell_1-regularization-in-Li-Mn-Ti-O-system" title="Permalink to this headline">¶</a></h1>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[46]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">coefs_l1</span> <span class="o">=</span> <span class="n">l1_optimize</span><span class="p">(</span><span class="n">A</span><span class="o">=</span><span class="n">wrangler</span><span class="o">.</span><span class="n">feature_matrix</span><span class="p">,</span>
                   <span class="n">f</span><span class="o">=</span> <span class="n">wrangler</span><span class="o">.</span><span class="n">get_property_vector</span><span class="p">(</span><span class="s1">&#39;total_energy&#39;</span><span class="p">),</span>
                   <span class="n">mu</span> <span class="o">=</span> <span class="mf">1e-4</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">coefs_l1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[-12.13517258  -3.82446197  -2.01972233   1.89679575   1.24721833
  -0.01437917   0.75156937  -0.39776007   0.18292662   0.56033911
   0.02660087  -0.30362049   0.37305809   0.02952346  -0.10023389
   0.35345145  -0.39812598  -0.02524803   0.18692421  -2.72119993
  -0.55522068   1.03001267  -0.12110085   0.81454395   0.57350035
  -0.91274639  -0.26928441]
</pre></div></div>
</div>
</section>
<section id="Optimization-of-\ell_1\ell_0-regularization-in-Li-Mn-Ti-O-system">
<h1>Optimization of <span class="math notranslate nohighlight">\(\ell_1\ell_0\)</span> regularization in Li-Mn-Ti-O system<a class="headerlink" href="#Optimization-of-\ell_1\ell_0-regularization-in-Li-Mn-Ti-O-system" title="Permalink to this headline">¶</a></h1>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[49]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">coefs_l0l1</span> <span class="o">=</span> <span class="n">l0l1_optimize</span><span class="p">(</span><span class="n">A</span><span class="o">=</span><span class="n">wrangler</span><span class="o">.</span><span class="n">feature_matrix</span><span class="p">,</span>
                   <span class="n">f</span><span class="o">=</span> <span class="n">wrangler</span><span class="o">.</span><span class="n">get_property_vector</span><span class="p">(</span><span class="s1">&#39;total_energy&#39;</span><span class="p">),</span>
                   <span class="n">mu1</span> <span class="o">=</span> <span class="mf">1e-4</span><span class="p">,</span> <span class="n">mu0</span> <span class="o">=</span> <span class="mf">1e-3</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">coefs_l0l1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Changed value of parameter TimeLimit to 300.0
   Prev: inf  Min: 0.0  Max: inf  Default: inf
Changed value of parameter PSDTol to 1e-05
   Prev: 1e-06  Min: 0.0  Max: inf  Default: 1e-06
[-1.03648403e+01 -7.34620338e+00  0.00000000e+00  1.86403110e+00
  5.49912335e-01 -1.51873893e-01  7.48583619e-01 -4.13430535e-01
  1.85496663e-01  5.53551411e-01 -2.14151613e-15 -2.87484027e-01
  3.70806863e-01 -2.48759346e-15 -1.06770779e-01  3.51162508e-01
 -4.05146941e-01  3.69149156e-15  2.05584933e-01 -1.93129275e+00
  0.00000000e+00  7.23583426e-01 -1.25808411e-01  5.11422848e-01
  1.76593585e-01 -7.23372821e-01  0.00000000e+00]
</pre></div></div>
</div>
</section>
<section id="Comparison-of-\ell_1-and-\ell_1\ell_0-in-Li-Mn-Ti-O-system">
<h1>Comparison of <span class="math notranslate nohighlight">\(\ell_1\)</span> and <span class="math notranslate nohighlight">\(\ell_1\ell_0\)</span> in Li-Mn-Ti-O system<a class="headerlink" href="#Comparison-of-\ell_1-and-\ell_1\ell_0-in-Li-Mn-Ti-O-system" title="Permalink to this headline">¶</a></h1>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[50]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">coefs_l1</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;L1&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">coefs_l0l1</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;L0L1&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>


<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Non-zero ECIs in L1: &quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">coefs_l1</span><span class="p">)</span><span class="o">&gt;</span><span class="mf">1e-6</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Non-zero ECIs in L0L1: &quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">coefs_l0l1</span><span class="p">)</span><span class="o">&gt;</span><span class="mf">1e-6</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Non-zero ECIs in L1:  27
Non-zero ECIs in L0L1:  21
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_advanced-cluster-expansion-fitting_optimization_LMTO_L0L1_13_1.png" src="../../_images/notebooks_advanced-cluster-expansion-fitting_optimization_LMTO_L0L1_13_1.png" />
</div>
</div>
<section id="4)-The-cluster-expansion">
<h2>4) The cluster expansion<a class="headerlink" href="#4)-The-cluster-expansion" title="Permalink to this headline">¶</a></h2>
<p>Now we can use the above work to create the <code class="docutils literal notranslate"><span class="pre">ClusterExpansion</span></code>. The cluster expansion can be used to predict the fitted property for new structures, either for testing quality or for simulations such as in Monte Carlo. Note that when using the <code class="docutils literal notranslate"><span class="pre">predict</span></code> function, the cluster expansion will have to match the given structure if it has not seen it before.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[51]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">expansion</span> <span class="o">=</span> <span class="n">ClusterExpansion</span><span class="p">(</span><span class="n">ce</span><span class="o">.</span><span class="n">cluster_subspace</span><span class="p">,</span>
                             <span class="n">coefficients</span><span class="o">=</span><span class="n">coefs_l0l1</span><span class="p">,</span>
                             <span class="n">feature_matrix</span><span class="o">=</span><span class="n">wrangler</span><span class="o">.</span><span class="n">feature_matrix</span><span class="p">)</span>

<span class="n">structure</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">wrangler</span><span class="o">.</span><span class="n">structures</span><span class="p">)</span>
<span class="n">prediction</span> <span class="o">=</span> <span class="n">expansion</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The predicted energy for a structure with composition &#39;</span>
      <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">structure</span><span class="o">.</span><span class="n">composition</span><span class="si">}</span><span class="s1"> is </span><span class="si">{</span><span class="n">prediction</span><span class="si">}</span><span class="s1"> eV/prim.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The fitted coefficients are:</span><span class="se">\n</span><span class="si">{</span><span class="n">expansion</span><span class="o">.</span><span class="n">coefs</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The effective cluster interactions are:</span><span class="se">\n</span><span class="si">{</span><span class="n">expansion</span><span class="o">.</span><span class="n">eci</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">expansion</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
The predicted energy for a structure with composition Mn3+18 Li+18 O2-36 is -13.135709227103828 eV/prim.

The fitted coefficients are:
[-1.03648403e+01 -7.34620338e+00  0.00000000e+00  1.86403110e+00
  5.49912335e-01 -1.51873893e-01  7.48583619e-01 -4.13430535e-01
  1.85496663e-01  5.53551411e-01 -2.14151613e-15 -2.87484027e-01
  3.70806863e-01 -2.48759346e-15 -1.06770779e-01  3.51162508e-01
 -4.05146941e-01  3.69149156e-15  2.05584933e-01 -1.93129275e+00
  0.00000000e+00  7.23583426e-01 -1.25808411e-01  5.11422848e-01
  1.76593585e-01 -7.23372821e-01  0.00000000e+00]

The effective cluster interactions are:
[-1.03648403e+01 -7.34620338e+00  0.00000000e+00  3.10671850e-01
  9.16520559e-02 -2.53123156e-02  2.49527873e-01 -1.37810178e-01
  6.18322210e-02  4.61292842e-02 -1.78459678e-16 -2.39570023e-02
  6.18011439e-02 -4.14598911e-16 -1.77951299e-02  2.92635423e-02
 -3.37622451e-02  3.07624296e-16  2.56981166e-02 -2.41411593e-01
  0.00000000e+00  9.04479282e-02 -6.29042057e-02  2.55711424e-01
  8.82967926e-02 -3.61686410e-01  0.00000000e+00]

ClusterExpansion:
    Prim Composition: Li+0.33333333 Mn3+0.33333333 Ti4+0.33333333 O2-1
 Num fit structures: 630
Num orbit functions: 27
    [Orbit]  id: 0
        bit       eci
        [X]       -10.4
    [Orbit]  id: 1   size: 1   radius: 0.0
        id    bit       eci     feature avg  feature std  eci*std
        1     [0]       -7.346  0.558        0.059        -0.436
        2     [1]       0.000   0.116        0.119        0.000
    [Orbit]  id: 3   size: 2   radius: 2.97
        id    bit       eci     feature avg  feature std  eci*std
        3     [0 0]     1.864   0.283        0.073        0.135
        4     [0 1]     0.550   0.083        0.088        0.048
        5     [1 1]     -0.152  0.019        0.028        -0.004
    [Orbit]  id: 6   size: 2   radius: 4.2
        id    bit       eci     feature avg  feature std  eci*std
        6     [0 0]     0.749   0.301        0.070        0.053
        7     [0 1]     -0.413  0.083        0.093        -0.039
        8     [1 1]     0.185   0.019        0.033        0.006
    [Orbit]  id: 9   size: 2   radius: 5.14
        id    bit       eci     feature avg  feature std  eci*std
        9     [0 0]     0.554   0.334        0.072        0.040
        10    [0 1]     -0.000  0.064        0.072        -0.000
        11    [1 1]     -0.287  0.031        0.043        -0.012
    [Orbit]  id: 12  size: 2   radius: 5.94
        id    bit       eci     feature avg  feature std  eci*std
        12    [0 0]     0.371   0.313        0.089        0.033
        13    [0 1]     -0.000  0.069        0.076        -0.000
        14    [1 1]     -0.107  0.030        0.048        -0.005
    [Orbit]  id: 15  size: 2   radius: 6.64
        id    bit       eci     feature avg  feature std  eci*std
        15    [0 0]     0.351   0.308        0.073        0.026
        16    [0 1]     -0.405  0.073        0.078        -0.032
        17    [1 1]     0.000   0.026        0.036        0.000
    [Orbit]  id: 18  size: 3   radius: 2.97
        id    bit       eci     feature avg  feature std  eci*std
        18    [0 0 0]   0.206   0.125        0.064        0.013
        19    [0 0 1]   -1.931  0.057        0.062        -0.120
        20    [0 1 1]   0.000   0.016        0.023        0.000
        21    [1 1 1]   0.724   0.002        0.006        0.004
    [Orbit]  id: 22  size: 4   radius: 2.97
        id    bit       eci     feature avg  feature std  eci*std
        22    [0 0 0 0] -0.126  0.046        0.049        -0.006
        23    [0 0 0 1] 0.511   0.036        0.042        0.022
        24    [0 0 1 1] 0.177   0.013        0.019        0.003
        25    [0 1 1 1] -0.723  0.002        0.006        -0.004
        26    [1 1 1 1] 0.000   0.000        0.002        0.000

</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/anaconda3/lib/python3.7/site-packages/ipykernel_launcher.py:5: VisibleDeprecationWarning: Creating an ndarray from ragged nested sequences (which is a list-or-tuple of lists-or-tuples-or ndarrays with different lengths or shapes) is deprecated. If you meant to do this, you must specify &#39;dtype=object&#39; when creating the ndarray
  &#34;&#34;&#34;
</pre></div></div>
</div>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
      
    </p>
    <p>
        &copy; Copyright 2020, Ceder Group.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.1.2.<br/>
    </p>
  </div>
</footer>
  </body>
</html>