<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Running Canonical Monte Carlo Sampling &#8212; smol 1.0.0 documentation</title>
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/_static/default.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../_static/bootstrap-sphinx.js "></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          smol</a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../examples.html">Examples</a></li>
                <li><a href="../api.html">API</a></li>
                <li><a href="https://github.com/CederGroupHub/smol">GitHub</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"></ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Running Canonical Monte Carlo Sampling</a><ul>
<li><a class="reference internal" href="#0)-Load-the-previous-LNO-CE-with-electrostatics">0) Load the previous LNO CE with electrostatics</a></li>
<li><a class="reference internal" href="#1)-Create-a-canonical-ensemble">1) Create a canonical ensemble</a></li>
<li><a class="reference internal" href="#3)-Create-an-MC-sampler">3) Create an MC sampler</a></li>
<li><a class="reference internal" href="#3)-Create-an-initial-structure-and-get-occupancies">3) Create an initial structure and get occupancies</a></li>
<li><a class="reference internal" href="#4)-Run-MC-iterations">4) Run MC iterations</a><ul>
<li><a class="reference internal" href="#4.1)-Continuing-or-reseting-the-MC-trajectory">4.1) Continuing or reseting the MC trajectory</a></li>
</ul>
</li>
<li><a class="reference internal" href="#5)-Look-at-trajectory-samples-and-averages">5) Look at trajectory samples and averages</a></li>
<li><a class="reference internal" href="#Save-your-work">Save your work</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container,
div.nbinput.container div.prompt,
div.nbinput.container div.input_area,
div.nbinput.container div[class*=highlight],
div.nbinput.container div[class*=highlight] pre,
div.nboutput.container,
div.nboutput.container div.prompt,
div.nboutput.container div.output_area,
div.nboutput.container div[class*=highlight],
div.nboutput.container div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="section" id="Running-Canonical-Monte-Carlo-Sampling">
<h1>Running Canonical Monte Carlo Sampling<a class="headerlink" href="#Running-Canonical-Monte-Carlo-Sampling" title="Permalink to this headline">¶</a></h1>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">pymatgen.core.structure</span> <span class="kn">import</span> <span class="n">Structure</span>
<span class="kn">from</span> <span class="nn">smol.io</span> <span class="kn">import</span> <span class="n">load_work</span>
</pre></div>
</div>
</div>
<div class="section" id="0)-Load-the-previous-LNO-CE-with-electrostatics">
<h2>0) Load the previous LNO CE with electrostatics<a class="headerlink" href="#0)-Load-the-previous-LNO-CE-with-electrostatics" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">work</span> <span class="o">=</span> <span class="n">load_work</span><span class="p">(</span><span class="s1">&#39;data/basic_ce_ewald.mson&#39;</span><span class="p">)</span>
<span class="n">expansion</span> <span class="o">=</span> <span class="n">work</span><span class="p">[</span><span class="s1">&#39;ClusterExpansion&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="1)-Create-a-canonical-ensemble">
<h2>1) Create a canonical ensemble<a class="headerlink" href="#1)-Create-a-canonical-ensemble" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">CanonicalEnsemble</span></code> class is used to run MC in a fixed composition ensemble. The ensemble classes will determine the <strong>active</strong> sublattices by grouping all sites that have the same possible partial occupancies.</p>
<p>To run for fixed chemical potential see the notebook on semigrand ensemble MC.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">smol.moca</span> <span class="kn">import</span> <span class="n">CanonicalEnsemble</span>

<span class="c1"># Create the ensemble</span>
<span class="c1"># This specifies the size of the MC simulation domain.</span>
<span class="n">sc_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                      <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                      <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]])</span>

<span class="c1"># this convenience method will take care of creating the appropriate</span>
<span class="c1"># processor for the given cluster expansion.</span>
<span class="n">ensemble</span> <span class="o">=</span> <span class="n">CanonicalEnsemble</span><span class="o">.</span><span class="n">from_cluster_expansion</span><span class="p">(</span><span class="n">expansion</span><span class="p">,</span>
                                                    <span class="n">sc_matrix</span><span class="p">)</span>

<span class="c1"># In a real scenario you may want a much larger processor.size</span>
<span class="c1"># An MC step is O(1) with the processor.size, meaning it runs at</span>
<span class="c1"># the same speed regardless of the size. However, larger sizes</span>
<span class="c1"># will need many more steps to reach equilibrium in an MC simulation.</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The supercell size for the processor is </span><span class="si">{ensemble.processor.size}</span><span class="s1"> prims.&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The ensemble has a total of </span><span class="si">{ensemble.num_sites}</span><span class="s1"> sites.&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The active sublattices are:&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">sublattice</span> <span class="ow">in</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">sublattices</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">sublattice</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
The supercell size for the processor is 16 prims.
The ensemble has a total of 64 sites.
The active sublattices are:
Sublattice
 Site space: {Species Ni3+: 0.5, Species Ni4+: 0.5}
 Number of sites: 16

Sublattice
 Site space: {Species Li+: 0.5, Vacancy vacA0+: 0.5}
 Number of sites: 16

</pre></div></div>
</div>
</div>
<div class="section" id="3)-Create-an-MC-sampler">
<h2>3) Create an MC sampler<a class="headerlink" href="#3)-Create-an-MC-sampler" title="Permalink to this headline">¶</a></h2>
<p>A <code class="docutils literal notranslate"><span class="pre">Sampler</span></code> will take care of running MC sampling runs for a given ensemble. The sampler allows many different options for MC sampling most importantly setting the MCMC algorithm and the type of MC steps taken. However the defaults are usually enough for almost all use cases.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">smol.moca</span> <span class="kn">import</span> <span class="n">Sampler</span>

<span class="c1"># This will take care of setting the defaults</span>
<span class="c1"># for the supplied canonical ensemble</span>
<span class="n">sampler</span> <span class="o">=</span> <span class="n">Sampler</span><span class="o">.</span><span class="n">from_ensemble</span><span class="p">(</span><span class="n">ensemble</span><span class="p">,</span>
                                <span class="n">temperature</span><span class="o">=</span><span class="mi">1500</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sampling information: </span><span class="si">{sampler.samples.metadata}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Sampling information: {&#39;name&#39;: &#39;CanonicalEnsemble&#39;, &#39;kernel&#39;: &#39;Metropolis&#39;, &#39;step&#39;: &#39;swap&#39;, &#39;seed&#39;: 16199914525253226741}
</pre></div></div>
</div>
</div>
<div class="section" id="3)-Create-an-initial-structure-and-get-occupancies">
<h2>3) Create an initial structure and get occupancies<a class="headerlink" href="#3)-Create-an-initial-structure-and-get-occupancies" title="Permalink to this headline">¶</a></h2>
<p>You will need to create an initial test structure to obtain an initial occupancy to start an MC run. There are many ways to do this, you could simply rescale a training structure and use that. But since the composition is fixed in a canonical ensemble you need to make sure you input the right composition. It can also be helpful to run a simulated anneal step to get a good initial structure rather than starting with a low energy one.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">pymatgen.transformations.standard_transformations</span> <span class="kn">import</span> <span class="n">OrderDisorderedStructureTransformation</span>

<span class="c1"># Here we will just use the order disordered transformation from</span>
<span class="c1"># pymatgen to get an ordered version of a prim supercell.</span>
<span class="c1"># The structure will have the same composition set in the prim.</span>
<span class="n">transformation</span> <span class="o">=</span> <span class="n">OrderDisorderedStructureTransformation</span><span class="p">()</span>

<span class="n">supercell</span> <span class="o">=</span> <span class="n">expansion</span><span class="o">.</span><span class="n">cluster_subspace</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">supercell</span><span class="o">.</span><span class="n">make_supercell</span><span class="p">(</span><span class="n">sc_matrix</span><span class="p">)</span>

<span class="c1"># this can take a bit of time....</span>
<span class="n">test_struct</span> <span class="o">=</span> <span class="n">transformation</span><span class="o">.</span><span class="n">apply_transformation</span><span class="p">(</span><span class="n">supercell</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">test_struct</span><span class="o">.</span><span class="n">composition</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Li+8 Ni3+8 Ni4+8 O2-32
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Obtain the initial occupancy string from the</span>
<span class="c1"># test structure created above.</span>
<span class="n">init_occu</span> <span class="o">=</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">processor</span><span class="o">.</span><span class="n">occupancy_from_structure</span><span class="p">(</span><span class="n">test_struct</span><span class="p">)</span>

<span class="c1"># The occupancy strings created by the processor</span>
<span class="c1"># are by default &quot;encoded&quot; by the indices of the species</span>
<span class="c1"># for each given site. You can always see the actual</span>
<span class="c1"># species in the occupancy string by decoding it.</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The encoded occupancy is:</span><span class="se">\n</span><span class="si">{init_occu}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The initial occupancy is:</span><span class="se">\n</span><span class="s1"> {ensemble.processor.decode_occupancy(init_occu)}&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
The encoded occupancy is:
[0 1 1 0 0 0 1 0 0 1 0 1 1 1 1 0 0 0 1 1 1 1 0 1 0 0 1 0 0 0 1 1 0 0 0 0 0
 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]
The initial occupancy is:
 [Species Li+, Vacancy vacA0+, Vacancy vacA0+, Species Li+, Species Li+, Species Li+, Vacancy vacA0+, Species Li+, Species Li+, Vacancy vacA0+, Species Li+, Vacancy vacA0+, Vacancy vacA0+, Vacancy vacA0+, Vacancy vacA0+, Species Li+, Species Ni3+, Species Ni3+, Species Ni4+, Species Ni4+, Species Ni4+, Species Ni4+, Species Ni3+, Species Ni4+, Species Ni3+, Species Ni3+, Species Ni4+, Species Ni3+, Species Ni3+, Species Ni3+, Species Ni4+, Species Ni4+, Species O2-, Species O2-, Species O2-, Species O2-, Species O2-, Species O2-, Species O2-, Species O2-, Species O2-, Species O2-, Species O2-, Species O2-, Species O2-, Species O2-, Species O2-, Species O2-, Species O2-, Species O2-, Species O2-, Species O2-, Species O2-, Species O2-, Species O2-, Species O2-, Species O2-, Species O2-, Species O2-, Species O2-, Species O2-, Species O2-, Species O2-, Species O2-]
</pre></div></div>
</div>
</div>
<div class="section" id="4)-Run-MC-iterations">
<h2>4) Run MC iterations<a class="headerlink" href="#4)-Run-MC-iterations" title="Permalink to this headline">¶</a></h2>
<p>MC iterations are by default run by swapping sites from all active sublattices, but fine grained simulations can also be ran by only flipping on some of the active sublattices or even freezen specific sites in active sublattices. MC samples are saved in a <code class="docutils literal notranslate"><span class="pre">SampleContainer</span></code> created or given to the <code class="docutils literal notranslate"><span class="pre">Sampler</span></code> when created.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># run 1M iterations</span>
<span class="c1"># since this is the first run, the initial occupancy must be supplied</span>
<span class="n">sampler</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="mi">1000000</span><span class="p">,</span>
            <span class="n">initial_occupancies</span><span class="o">=</span><span class="n">init_occu</span><span class="p">,</span>
            <span class="n">thin_by</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="c1"># thin_by will save every 100th sample only</span>
            <span class="n">progress</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># progress will show progress bar</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Sampling 1 chain(s) at 1500.00 K from a cell with 64 sites: 100%|██████████| 1000000/1000000 [01:50&lt;00:00, 9069.45it/s]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Samples are saved in a sample container</span>
<span class="n">samples</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">samples</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Fraction of succesfull steps (efficiency) {sampler.efficiency()}&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The last step energy is {samples.get_energies()[-1]} eV&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The minimum energy in trajectory is {samples.get_minimum_energy()} eV&#39;</span><span class="p">)</span>

<span class="c1"># You can get the minimum energy structure and current structure</span>
<span class="c1"># by using the ensemble processor</span>
<span class="n">curr_s</span> <span class="o">=</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">processor</span><span class="o">.</span><span class="n">structure_from_occupancy</span><span class="p">(</span><span class="n">samples</span><span class="o">.</span><span class="n">get_occupancies</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">min_s</span> <span class="o">=</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">processor</span><span class="o">.</span><span class="n">structure_from_occupancy</span><span class="p">(</span><span class="n">samples</span><span class="o">.</span><span class="n">get_minimum_energy_occupancy</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Fraction of succesfull steps (efficiency) 0.390277
The last step energy is -551.4509466160619 eV
The minimum energy in trajectory is -552.6314360816017 eV
</pre></div></div>
</div>
<div class="section" id="4.1)-Continuing-or-reseting-the-MC-trajectory">
<h3>4.1) Continuing or reseting the MC trajectory<a class="headerlink" href="#4.1)-Continuing-or-reseting-the-MC-trajectory" title="Permalink to this headline">¶</a></h3>
<p>You can always continue running more iterations from where the trajectory left off by calling <code class="docutils literal notranslate"><span class="pre">run</span></code> again. You can also reset to the initial state. (we will skip this step for now so we can show results from the run above.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># You can continue the MC trajectory simmply by calling run again</span>
<span class="c1"># it is recommended to use the same thin_by used before</span>
<span class="c1">#sampler.run(10000, thin_by=100)  # this will append new data</span>

<span class="c1"># If you want to start from scratch</span>
<span class="c1">#sampler.clear_samples()  # this will delete data, and reset the ensemble to its initial state</span>
<span class="c1"># Now you can start a fresh run</span>
<span class="c1">#sampler.run(1000000,</span>
<span class="c1">#             initial_occupancies=init_occu,</span>
<span class="c1">#             thin_by=100, # thin_by will save every 100th sample only</span>
<span class="c1">#             progress=True) # progress will show progress bar</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="5)-Look-at-trajectory-samples-and-averages">
<h2>5) Look at trajectory samples and averages<a class="headerlink" href="#5)-Look-at-trajectory-samples-and-averages" title="Permalink to this headline">¶</a></h2>
<p>We can look at the sampled energies, the average and varience directly from the class properties.</p>
<p>For further analysis samples are stored as a list of dictionaries for each sampled step in the <code class="docutils literal notranslate"><span class="pre">CanonicalEnsemble.data</span></code> attribute. In the <code class="docutils literal notranslate"><span class="pre">CanonicalEnsemble</span></code> class only the energy and occupancy string of each sample are saved.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># you can discard burn-in samples from analysis</span>
<span class="c1"># ie here we set 1000 samples as burn-in</span>
<span class="n">discard</span> <span class="o">=</span> <span class="mi">1000</span> <span class="c1"># this is in terms of samples so it would be discard*thin_by steps</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;A total of {len(samples)} samples taken.&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;A total of {len(samples.get_energies(discard=discard))} samples used for production.&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The average energy is {samples.mean_energy(discard=discard)} eV&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The energy variance is {samples.energy_variance(discard=discard)} eV^2&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
A total of 10000 samples taken.
A total of 9000 samples used for production.
The average energy is -551.7860869325897 eV
The energy variance is 0.04600543434696906 eV^2
</pre></div></div>
</div>
</div>
<div class="section" id="Save-your-work">
<h2>Save your work<a class="headerlink" href="#Save-your-work" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">Sampler</span></code> class does and can not be saved since it does not really have any computed values. However the <code class="docutils literal notranslate"><span class="pre">SampleContainter</span></code> where the MC samples are recorded can be saved. You can use the same <code class="docutils literal notranslate"><span class="pre">save_work</span></code> convenience function to save your work.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">smol.io</span> <span class="kn">import</span> <span class="n">save_work</span>

<span class="n">file_path</span> <span class="o">=</span> <span class="s1">&#39;data/canonical_mc_samples.mson&#39;</span>
<span class="n">save_work</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">samples</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
      
    </p>
    <p>
        &copy; Copyright 2020, Ceder Group.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.2.1.<br/>
    </p>
  </div>
</footer>
  </body>
</html>