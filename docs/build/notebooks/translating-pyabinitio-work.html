<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>&lt;no title&gt; &#8212; smol 1.0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../_static/_static/default.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../_static/bootstrap-sphinx.js "></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          smol</a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../examples.html">Examples</a></li>
                <li><a href="../api.html">API</a></li>
                <li><a href="https://github.com/CederGroupHub/smol">GitHub</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"></ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul class="simple">
</ul>
</ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <dl>
<dt>{</dt><dd><dl>
<dt>“cells”: [</dt><dd><dl>
<dt>{</dt><dd><p>“cell_type”: “markdown”,
“metadata”: {},
“source”: [</p>
<blockquote>
<div><p>“# Translating a Cluster Expansion created with <cite>pyabinitio.cluster_expansion</cite>”</p>
</div></blockquote>
<p>]</p>
</dd>
</dl>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “code”,
“execution_count”: 1,
“metadata”: {},
“outputs”: [</p>
<blockquote>
<div><dl>
<dt>{</dt><dd><p>“name”: “stderr”,
“output_type”: “stream”,
“text”: [</p>
<blockquote>
<div><p>“/home/lbluque/Develop/pymatgen/pymatgen/ext/matproj.py:454: DeprecationWarning: __init__ is deprecatedn”,
“MaterialsProjectCompatibility will be updated with new correction classes as well as new values of corrections and uncertainties in 2020n”,
”  def get_pourbaix_entries(self, chemsys, solid_compat=MaterialsProjectCompatibility()):n”</p>
</div></blockquote>
<p>]</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>],
“source”: [</p>
<blockquote>
<div><p>“import numpy as npn”,
“from monty.serialization import loadfnn”,
“from pyabinitio.cluster_expansion.eci_fit import EciGeneratorn”,
“from smol.cofe import ClusterSubspace, StructureWrangler, ClusterExpansionn”,
“from smol.cofe.extern import EwaldTerm”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “markdown”,
“metadata”: {},
“source”: [</p>
<blockquote>
<div><p>“### 1) Loading and extracting information from a pyabinitio <cite>EciGenerator</cite>n”,
“n”,
“Cluster expansions created with the <cite>pyabinitio.cluster_expanstion</cite> module,n”,
“can be very easily translated into <cite>smol</cite>.n”,
“n”,
“The only thing you will need is the <cite>EciGenerator</cite> objectn”,
“you created.”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “code”,
“execution_count”: 3,
“metadata”: {},
“outputs”: [</p>
<blockquote>
<div><dl>
<dt>{</dt><dd><p>“name”: “stdout”,
“output_type”: “stream”,
“text”: [</p>
<blockquote>
<div><p>“This is the prim n”,
“Full Formula (Li0.5 Ni1 O2)n”,
“Reduced Formula: Li0.5Ni1O2n”,
“abc   :   2.969848   2.969848   5.143928n”,
“angles:  73.221350  73.221347  60.000002n”,
“Sites (4)n”,
”  #  SP                         a     b     cn”,
“—  ———————-  —-  —-  —-n”,
”  0  Li+:0.500               0     0     0n”,
”  1  Ni3+:0.500, Ni4+:0.500  0.5   0.5   0.5n”,
”  2  O2-                     0.75  0.75  0.75n”,
”  3  O2-                     0.25  0.25  0.25n”,
“n”,
“Cutoff radii obtained are {2: 4.199999454995874, 3: 5.939696563574085, 4: 2.9698482817870424}n”,
“n”,
“Cluster expansion used Ewald: Truen”,
“Was the dieletric constrained: Falsen”</p>
</div></blockquote>
<p>]</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>],
“source”: [</p>
<blockquote>
<div><p>“# load a ecigenerator object you previously createdn”,
“file_path = ‘data/ecigenerator.mson’n”,
“ecigen = loadfn(file_path)n”,
“n”,
“# Get the prim structuren”,
“prim = ecigen.ce.structuren”,
“n”,
“print(f’This is the prim \n{prim}\n’)n”,
“n”,
“# Get cluster diameter cutoffs from previous CE objectn”,
“cutoffs = {}n”,
“for size, clusters in ecigen.ce.clusters.items():n”,
”    if size == 1: continuen”,
”    cutoffs[size] = max([c.max_radius for c in clusters])n”,
“n”,
“print(f’Cutoff radii obtained are {cutoffs}\n’)n”,
“n”,
“# determine if an ewald term is usedn”,
“use_ewald = ecigen.ce.use_ewaldn”,
“print(f’Cluster expansion used Ewald: {use_ewald}’)n”,
“n”,
“# Check the fit did not constrain dielectricn”,
“# In case you plan to refit the same way.n”,
“print(f’Was the dieletric constrained: ‘n”,
”      f’{ecigen.max_dielectric is not None}’)n”,
“n”,
“# obtain the structurematcher parameters usedn”,
“# You should get these because the default valuesn”,
“# in smol are different then pyabinition”,
“# in smol the pymatgen defaults are used.n”,
“supercell_size = ecigen.ce.supercell_sizen”,
“ltol = ecigen.ce.ltoln”,
“stol = ecigen.ce.stoln”,
“angle_tol = ecigen.ce.angle_tol”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “markdown”,
“metadata”: {},
“source”: [</p>
<blockquote>
<div><p>“### 2) Now create the corresponding <cite>ClusterSubspace</cite>n”,
“n”,
“We can now create the corrseponding subspace using <cite>smol</cite>. Here you can choose to use a different basis if you want to refit to an orthogonal one. In this example we will keep the <strong>indicator</strong> basis to compare that our new features match the ones from before.”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “code”,
“execution_count”: 7,
“metadata”: {},
“outputs”: [],
“source”: [</p>
<blockquote>
<div><p>“basis=’indicator’n”,
“subspace = ClusterSubspace.from_cutoffs(prim,n”,
”                                        cutoffs=cutoffs,n”,
”                                        ltol=ltol,n”,
”                                        stol=stol,n”,
”                                        angle_tol=angle_tol,n”,
”                                        supercell_size=supercell_size,n”,
”                                        basis=basis)n”,
“n”,
“if use_ewald:n”,
”    subspace.add_external_term(EwaldTerm())n”,
“n”,
“n”,
“# Check that the number of orbits and orderings matchesn”,
“assert subspace.num_orbits == ecigen.ce.n_sclustersn”,
“assert subspace.num_corr_functions == ecigen.ce.n_bit_orderings”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “markdown”,
“metadata”: {},
“source”: [</p>
<blockquote>
<div><p>“### 3) We can now create a <cite>StructureWrangler</cite> and add the structures used.n”,
“n”,
“If you don’t plan to refit or compare that features are the samen”,
“(if still using indicator basis), then you can skip to 4)”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “code”,
“execution_count”: 8,
“metadata”: {},
“outputs”: [],
“source”: [</p>
<blockquote>
<div><p>“# create the wranglern”,
“wrangler = StructureWrangler(subspace)n”,
“n”,
“for item in ecigen.items:n”,
”    structure = item[‘structure’]n”,
”    # giving it the matrix will make thingsn”,
”    # faster but it should work either wayn”,
”    # unless you didnt use the same StuctureMatcher optionsn”,
”    scmatrix = item[‘supercell’].supercell_matrixn”,
”    energy = item[‘energy’]n”,
”    weight = item[‘weight’]n”,
”    wrangler.add_data(structure,n”,
”                      properties={‘energy’: energy},n”,
”                      weights={‘whatever_you_used’: weight},n”,
”                      supercell_matrix=scmatrix,n”,
”                      verbose=True)”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “code”,
“execution_count”: 9,
“metadata”: {},
“outputs”: [],
“source”: [</p>
<blockquote>
<div><p>“# If using indicator basis, check that feature matrices matchn”,
“if basis == ‘indicator’:n”,
”    assert np.allclose(wrangler.feature_matrix,n”,
”                       ecigen.feature_matrix)”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “markdown”,
“metadata”: {},
“source”: [</p>
<blockquote>
<div><p>“### 4) Creating new <cite>ClusterExpansion</cite> using previous fitn”,
“n”,
“If you want to keep the previous fit you can just use the n”,
“eci directly in the new cluster expansionn”,
“(the previous implementation in pyabinitio has the ecin”,
“as the eci * multiplicity so these are the coefficients)n”,
“Make sure you are using an indicator basis otherwisen”,
“it makes no sense to use the same eci”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “code”,
“execution_count”: 10,
“metadata”: {},
“outputs”: [],
“source”: [</p>
<blockquote>
<div><p>“old_coefs = ecigen.ecisn”,
“expansion = ClusterExpansion(subspace,n”,
”                             coefficients=old_coefs,n”,
”                             feature_matrix=wrangler.feature_matrix)n”,
“n”,
“# Compare a few predictions to make sure everything matchesn”,
“ids = np.random.choice((len(wrangler.structures)), size=10)n”,
“for i in ids:n”,
”    struct = wrangler.structures[i]n”,
”    assert np.isclose(ecigen.structure_energy(struct),n”,
”                      expansion.predict(struct))”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “markdown”,
“metadata”: {},
“source”: [</p>
<blockquote>
<div><p>“### 5) (Re)Fitting the <cite>ClusterExpansion</cite>n”,
“n”,
“You can also refit the cluster expansion (this is usefuln”,
“if you want to switch over to using an orthogonal basis)n”,
“Here we will just redo it with the original indicator basisn”,
“to compare with the old fit.”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “code”,
“execution_count”: 11,
“metadata”: {},
“outputs”: [</p>
<blockquote>
<div><dl>
<dt>{</dt><dd><p>“name”: “stderr”,
“output_type”: “stream”,
“text”: [</p>
<blockquote>
<div><p>“&lt;ipython-input-11-892db5b83e08&gt;:5: DeprecationWarning: This class will be deprecated soon, so do not get too attached to it.n”,
“Consider using 3rd party estimators such as scikit learn.n”,
”  estimator = WDRLasso()n”</p>
</div></blockquote>
<p>]</p>
</dd>
</dl>
<p>},
{</p>
<blockquote>
<div><p>“name”: “stdout”,
“output_type”: “stream”,
“text”: [</p>
<blockquote>
<div><p>“(-212.92970249164134, -212.929702396418)n”,
“(-212.14197927342383, -212.14197918191735)n”,
“(-206.95984156567107, -206.9598414710193)n”,
“(-212.75037649702597, -212.75037640515274)n”,
“(-207.1096266240102, -207.1096265250885)n”,
“(-212.75037649702597, -212.75037640515274)n”,
“(-207.29469231924628, -207.2946922217547)n”,
“(-200.62910151985614, -200.62910142172657)n”,
“(-194.51464229296096, -194.51464218954325)n”,
“(-218.95642689474653, -218.95642680173313)n”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>],
“source”: [</p>
<blockquote>
<div><p>“# the ecigenerators use the old l1regs by defaultn”,
“# so we will use the same for comparisonn”,
“from theorytoolkit.regression import WDRLasson”,
“n”,
“estimator = WDRLasso()n”,
“n”,
“# in this case it was an unweighted fit son”,
“# adding the weights makes no difference, butn”,
“# if you used by e above hull or compositionn”,
“# you need to do this to get a similar fitn”,
“estimator.fit(wrangler.feature_matrix,n”,
”              wrangler.get_property_vector(‘energy’, True),n”,
”              sample_weight=wrangler.get_weights(‘whatever_you_used’))n”,
“n”,
“new_coefs = <a href="#id1"><span class="problematic" id="id2">estimator.coef_</span></a>n”,
“n”,
“expansion = ClusterExpansion(subspace,n”,
”                             coefficients=new_coefs,n”,
”                             feature_matrix=wrangler.feature_matrix)n”,
“n”,
“# Lets check if our new fit is n”,
“ids = np.random.choice((len(wrangler.structures)), size=10)n”,
“for i in ids:n”,
”    struct = wrangler.structures[i]n”,
”    print((ecigen.structure_energy(struct),n”,
”                      expansion.predict(struct)))”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “markdown”,
“metadata”: {},
“source”: [</p>
<blockquote>
<div><p>“### Now you are ready to use your cluster expansion from before in <cite>smol</cite>!”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “code”,
“execution_count”: null,
“metadata”: {},
“outputs”: [],
“source”: []</p>
</div></blockquote>
<p>}</p>
</dd>
</dl>
<p>],
“metadata”: {</p>
<blockquote>
<div><dl class="simple">
<dt>“kernelspec”: {</dt><dd><p>“display_name”: “matx_dev”,
“language”: “python”,
“name”: “matx_dev”</p>
</dd>
</dl>
<p>},
“language_info”: {</p>
<blockquote>
<div><dl class="simple">
<dt>“codemirror_mode”: {</dt><dd><p>“name”: “ipython”,
“version”: 3</p>
</dd>
</dl>
<p>},
“file_extension”: “.py”,
“mimetype”: “text/x-python”,
“name”: “python”,
“nbconvert_exporter”: “python”,
“pygments_lexer”: “ipython3”,
“version”: “3.8.5”</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>},
“nbformat”: 4,
“nbformat_minor”: 4</p>
</dd>
</dl>
<p>}</p>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
      
    </p>
    <p>
        &copy; Copyright 2020, Ceder Group.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.1.2.<br/>
    </p>
  </div>
</footer>
  </body>
</html>